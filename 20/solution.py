def enhance(input_image, algorithm, enhancements_count):

    # wow fuck this
    outside_pixel = "."
    if algorithm[0] == "#":
        outside_pixel = algorithm[0] if enhancements_count % 2 else algorithm[511]

    def pad_image(image):
        padded_image = [[outside_pixel] * (len(image[0]) + 2)
                        for x in range(0, len(image) + 2)]
        for y in range(0, len(image)):
            for x in range(0, len(image[0])):
                padded_image[y + 1][x + 1] = image[y][x]
        return padded_image

    padded_image = pad_image(input_image)
    new_image = [[outside_pixel] * len(padded_image[0])
                 for x in range(0, len(padded_image))]

    def calculate_pixel_number(image, x, y):
        pixels = []
        for dy in range(-1, 2):
            for dx in range(-1, 2):
                if y + dy < 0 or y + dy >= len(image) or x + dx < 0 or x + dx >= len(image[0]):
                    pixels.append("0" if outside_pixel == "." else "1")
                else:
                    pixel = image[y + dy][x + dx]
                    pixels.append("1" if pixel == "#" else "0")
        return int(''.join(pixels), 2)

    for y in range(0, len(padded_image)):
        for x in range(0, len(padded_image[0])):
            value = calculate_pixel_number(padded_image, x, y)
            new_image[y][x] = algorithm[value]

    return new_image


def solve(puzzle_input):
    algorithm = puzzle_input.strip().split("\n\n")[0].replace("\n", "")
    image = [[y for y in x] for x in puzzle_input.strip().split("\n\n")
             [1].split("\n")]

    image = image
    for i in range(0, 2):
        image = enhance(image, algorithm, i)

    # part 1
    count_lit = 0
    for y in range(0, len(image)):
        for x in range(0, len(image[0])):
            count_lit += 1 if image[y][x] == "#" else 0
    print(count_lit)

    for i in range(2, 50):
        image = enhance(image, algorithm, i)

    # part 2
    count_lit = 0
    for y in range(0, len(image)):
        for x in range(0, len(image[0])):
            count_lit += 1 if image[y][x] == "#" else 0
    print(count_lit)

    return


solve("""
####.#.#..####.#.####..#..#####.....#####.###..##.##......###.###.#.....####....####..##.##..####..........##.##...#..##..#.#.###..##...#....#...#..###.#.#####..#..#...#.####..####.#..##.#.#.###.##.##.....###..##....#....#.#.###.##.#..#..#..#######.#.##.#...#....#.....#.#..#.#.##.##.######.#..##.#..##..#####..#..###...##.#.###.#.#..###..###.....####....##...#.####.###.#.#.#..#..##.#..#.##.#.#####.####.#.#...##.####.#######...#....#####.##.#......##.######..###.###...##.##..##..#.#..####.##..#..##.#...#..#..

#..##..###.......##.##.#..##..##...#...####..#.###.#..##.#.#.#.#.##.#.##...#######..##..##.#.#..##.#
#...##....#..#####..#.#..##........#..#....##.##....#.##.##.....####...##...#..##.#....#......#...##
.#..#....#....#..##.#.##.#.##.#..#######....#.#...##..#.##.##..##.###..#...#.#.####.#..#..#####.#..#
##.#.#.....##...#..##.#..#####..#..#.####.#.##...##..#..######.#.#.#.#...#..##.###.##...#..#.#.#####
#.#.##..###...##..###......##.#.#.######.###.#.#..#.##.#.##.##..#...#..#....#.##.##....#.##...#...##
##########.....#..#..##.....#..##.#.##..##..#.##.###...#..#..##.#.#.#.###.#..##.##..###.###.#######.
...#.#...##..#.#..#..#.#.###..#....#.#.#.###..###..#......#..#.#.#.##...#..#..#.###.####.#..####...#
##..#....##.#...##..##.....#.####.##.#.#...#..######..##.#...##.####.###.#.....##...####..#......#..
##.#....###..##.##...#.#.#..#...#..###.#...#.#####.#.##..#.#.###...#####.#.###..#.##.###.#..#....#..
..#.#.......###....##.##..#.###.#..#...####...#.#.##.........#..#..##...#...#...#.##.#.#..##.#.#..#.
.###.###.########.#.##..#.....#####..#.....#..##..###....######.##.##..#..#.#####...##..##.....#.#.#
....#....##.#####..###...#..##..#.#.#.######...#.#.##.#......##.##......##..##..#.###.#..#####...##.
..##...#######..##.##.####.##.#.#.##.#.#####....#.###....###.......##########....#.#.#....##...####.
#.#..#.######....###.###.#.#######.#.....#..#.##...##..######....#....#....##.###.##......#..#.#.##.
.#...#...#....###...#######.##.#.......#..#...#...#####...##.##.....#.#..#....##..#..##...#.#.#..###
.#.#.#########..#.###.#.#.#.#....##.#####.##.#.#.......#.#.##.##...#..###...##..###..##...#....#.#.#
.#.##.#..#.#..##....##.....#.#.#.#.####.#.###..##.#...#..###....##.##..#.##..##...#......#####.#..##
####.#...##.#..#.#...####...#...#.#.####..#..#...##..#..#...#.#..##.#.#.##..#...###.###.####.#...###
...##..#..#...###.....##.####.....#...#..###..#.....################...####.###..##.####......#.##.#
..##..###.#....#......#...#.#.###..####..##...#.#..#.###..######..#.###.###.....#.##..##.#..#.#....#
.......#..#.........#............#.#..##...###.#..####..#.#..###....##....##.#..#.....#....#....#..#
.#......######....##..#.##.###..#####...##.#.#...##.#..##.#.##...#.##.##..#...#.########.#####.#...#
.....#.#.........#.###.#....#..########..####...#....##..#...#.#.#.#.#..##...#..#.###...#.########..
.#.####.##..##...#.#..###..##.#.#.#.#......#.##.#..###...#.#..###.....#..##....#.....#.#.#.#.#..#...
.#.#####.##..##.###.##.#..###....###.###...#####.#.#.#####.####..#..##.....###.......#.#..##...#####
#..#....###....#.#........###....#....#....###.....###...##.#....##....##.....##...#...##......#.###
.####.####...##.####...#..###.#..##.#..###.#......#####.#.#..#....##.###..#..#.#####.#.##..#...#..##
......#.#.#..#...#.#.......#.##..#.###.#####.#.##.######....##.#..###....#.#.#.###..##..#..#..#...##
###..#...##.###...#.#.#####....###...###.......##..#..###..#.##..###.####...######..#..#..#.#.......
##.#....###.##.#..#.#..#..###...##.....##.###.#..##...##...##.##.#......#.#...##..##...#..#.####.##.
#...#..##.#.####...##.#.#.##.####.#####....#.###.#..#..##.#.#.#...#..#.##..#..#.##.##.###..#.....#.#
.#.##....#.##....#..#.#...#.#..#####.......#..##....###...#.###.....##.###.#..###.##....#..##.##....
.#....##....##..#....####.###.#..####.##.#.########.#..#.###.#....###.####..#..#...#######....#.#.#.
#.#####...##......##.#.#.#..#.####..#..####.....#.###...#.##.#..#.####.#####..#.####...##.##.###....
....####..#..#....####.###.###.##.....#.#.#..##.##.##..###...##.......#..#.##.#...##.#....#.##......
#####...#####..###.....#...###..#.##..###...#.#..#...##..###..#......#...#...##.#.###.#####.##.#..##
##..#.######.#..#.###...##..##.#..#.#..#######..#.####..######.#......##.#...###...##..##...##....##
#..###..#..##..#..####.##..#...#.#..######.#.#######...##..##.#......##.#.##..#..######..#.#.#####.#
.###.##.##.#....#.#####...#.#.#.##...###.#.##..#.#.#..#.##.........###....#..##.....#.####....##..##
....#.###.###.#..#......###.#....#.###.#.#..##..##.#....#.#.##.#..#.#..##.#..#....#..####........##.
......#.##..###.#....#.#.#..#.####.....##..##.#..##......##..##.##...#.###.##..#.....#..........###.
####.#.#.#......###.#.####...##....#....#.#........##..#..######.#.##.####.#.###..##.#...#.##..#..#.
##....#.#.###.#.#...##..##....#...#...###.#....#.#....#..####..##....#.######.#.##.##.####.##..##.##
..#........#..###.##.#...##...#.###.#.##.#####.###.#.#..####.#.#.##..#....#.#.#.####..#....#...#.###
##...#..#.#...##....#..#.#.#......##.####.#...#........##.#.#.###...###...###........###.##.#....#.#
.##..#.####.#.##..#...##.###.#.#.#.##.####.##...#......#.#...##..........###.#....#..##..##....####.
..##..###.##.###...#.###.#..#..#...####..##..#######..#..#..#.########..#..#....##.###..#..#.#.#####
.....####..###.#.##....##.####.#....#.#.....#..#...#....######..#.####....##.#.#.#....##..####.#.###
.##.#..###......####.##.#..#.####.#.#....#.###.#..#####....#...##...######.##..####.#..##.##........
.......#.....####..#...##.###.#.#.#..#.#.....########.#.###.....####......####.#..#.....###.##...###
#..###.#....##.#....##.#..#.#.####.#.###..###.#########....#..####......##.##..##..###.##...#.#..#..
#..###.##......####.###.###.#.#.####..#...#.######..#####...##.#.##...##..#..#..#.#.##.####....#...#
#..#..#..#.#.##...#.#..##..##.#.######.##.##.####...##.#..##....##.#.##.#.###.##.####....###.##.#.#.
.#.#..##.#.#.###....#..#.#...#..###.#...##...######...####....#..####.#..#.#.##....#..#...#...#....#
.####.##...#.......#####.#.#..#.#..#...##...#.#..##.###..#....#..#..##.###.#####....###.#..#.##.####
##....###.#....#.##.#.#.#..#...##.##.....##.#....#..##...##.######..#.###.#..##..##.#.###....#...#.#
.#.##.......#....#..#....#..#.#...##...###.#.#.#.######..####..####.###.###.#.##.....#...##.##....#.
....#.###.##.#.##..#.....###..#.#......#.#####.##..#.##..#..###..#..#..#..#####..#.##.#....####.#..#
##......##.#.#..#.##...##....##..#..##.#....#.#.###.#.#..#.#####..###.#..###..##..#####..#...#.####.
#..#...#..#.#..#..#.#..#.###.#.#...#..##..#.###########.####..###.#.#..#.#.####..##..######.#.#....#
#....##..#..#####.###..###.#....#######.####.#....######.####..##.#..##.#..##.#.##....#.#####.#.###.
..###....##.#.#...##.#..#.###...#..#..#...########.#....##.###.####..#.#.##.######.#...#...##.##.#.#
.#..#.#....#.#...#.###.#...#.##.####.#.....#...###...##.##..####.#.#..####..##.###.#.#####.###..####
.#.#.##.#.#.#.#..#..#####...##..#..####.#..#.##.#.##..#..#..##.##.#.#.#######.....##.##.#....###.#.#
##.#.#...##...#.#.#.#..##.##..###.#######.####.##.#..#..####.##..#.#.###.#..###.....#..###.#.##...##
###.....####..##..##..###.##...#.##.#..##.###..##.#.##..##..#.#...##.#.#..##....#..##..#....#...####
...#.####.#...#.#.###.#.#...##....#..##.##.##.##.#...##......###...#...####..##....###.#..#..##.###.
.#.#..#.#.#..####.##..##..#..#####.#...#.#.#..#.#.....##.#.....#.......##.....#....###.##.#.#..#....
...######..#.#.####.#.#...##...#....#....##.#...###......##..#..#.##....#..###....###...##..#.#.#..#
###.####.###..#....##.###.##.#####..#.##..###.###.##.#.##.#####...#..###.#.#..##....#...#.#....###..
.#.#.#..#.############.#######.#####.##.##....####..##....####.##..#...##.###.......##.........###.#
##.#.#..##..#.##..#.#..##.#.###...#####.###.####...#..##..#.##.###...#...##.#..#.#..###.##...#...###
##.#...#.#..#.#.#.###....#.#.#.##.##.##.#.....#......###..#.#...###..##...#.##..#...###.....###..#..
.#..#.#.##..##.##.#.###.##.#.....#.#....##.#...#####....###...#.##...#..#....##.#..####..#...#.#.#.#
#.###...#...##.##.#.#.#.####.##.##.######...#..####..#.....####....#.#####....##.###.....#..#.#.#.#.
#.#.#.#....###..#.#.....#..#..##..###..#.#.#.....###..####..#.##.##.##.####....###.##.#....###..####
###.#.##.#.#.#.#..#..#.##########...####..#.#.##..##...#...#..#..#...#.#..###..#####..###.#....#####
##..####...##.....####.###..#.#######.#.##..#.#####.#....#.#....####.#.##...##....##..#.#.###.#.####
#.#.#.#.##.#.##.###.....##.#######.##.##..#####..####.#.##########.#.##.#.#....#.#.##..#..##.......#
....#.####.###...#..#####.####...#..#..##...#.....#.###...###.######.....#.#..#...#.....####..#.##..
.##.###.#....#..###.#..#.##.##.#......#.#.#.#.#.##...#.#..####.#.##.###..###...#.#.##....#..#..##...
##...####.##.#####.#....##...##...#.##..##.#.......####..#..#.#..#.#..##.#.##.#.###..#.#..###...#.##
...#####...###.#.##.#.#.#..#.#.#......#.#.####.#.#...#.....###....###.#.##.###.#.###.#.##.#.#.##.#.#
##.#.##.#.#.#####....###.#...##.###..##.###....#####..#.###.##.##.##.##...#.#.#.###.#..##.#...#.....
...####.#..#..#..#.#...###..##..###.#.###.##.##.####.#.#.#......#####...##.#..#.##.##.#.....#....##.
..#.#..###.#....##....#.#.#..#####.##.##.####..##..#....####..##..####.##.#######......#.#.#..#.##..
#.###.#.#.##.#.##..##.#..#.#######..#...#..##..##..##..##....##..####.##..#.#..#.....##.##.####..#.#
..##..#..##..##.##.###.##..#####...#..###..####...##..#.....###..#.#.##....##....##.#.##..#.....#..#
...#.##..###..#.#.#####..#...#.#.#..#..###.#.#.#.#........#..##..###......#..#.##.#..#.#...###.#.##.
#.##...#.#.#...##.......#...#..##...#.#..##...##.#....###.###.#.###...#........###.#####.#.##....##.
#.##..#......####..#....###..#.#..########.......#.####...#......######..#...#####.#.#.......#####.#
##.##..##.##.###.##.#.....#..##.#.#...###.......##.#.#...........#..#..##.#.##.#.###.#.###.##..#...#
...#.#####.##.#.....##..##.##.#..#.#....#.#####.######....####..#..##..#.#.#......##...#.#....##.#..
#.#####.#.###..##.#.##...#.#.###.#####.....#.##..##.##..#.##...##.##..########..#..#..###..#.#..####
..##.##.....#..#####.##..####.##...#...##.##..#..##.#.######.#.#..###...###...###.##..###....###.##.
##.##...#.####.#..#..#.#.#..#...##.#.....##.###.##.###.#.#..##.#.#.....#..#.###.###..#.#..#####.#...
.###......##..##.#..#......###.##...#..#..........##..#...#..######.#.#.....##....##.##.##.#.##..##.
#..##.#..##.##..#####......#.#..###..#.#....#.###..###..##.#.##..###..#.#.###..####.###..#.#....###.
..#..#####..#.#...##.##.##.#.#.#####...#...####.....##.##..#..#....#..#.....#......####.#....#.####.
.#.##.##...###...##.#....####..#####.##.#..#...##.#########.#..#..#.#.##.####.##########...#####..#.
""")
